---
- name: Create temp cert-manager directory
  file:
    path: '/tmp/sealed-secrets'
    state: directory
    mode: 0755

- name: Copy sealed-secrets templates
  template:
    src: "{{ item }}"
    dest: /tmp/sealed-secrets/{{ item | basename | regex_replace('\.j2$', '') }}
  with_fileglob:
    - ./templates/sealed-secrets/*.*

- name: Kustomize sealed-secrets
  become: true
  become_user: "{{ ansible_ssh_user }}"
  command: "kubectl apply -k /tmp/sealed-secrets"